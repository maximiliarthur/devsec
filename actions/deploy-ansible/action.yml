---
name: deploy-ansible
description: deploy the code to the server

runs:
  using: "composite"
  steps:
    - run: python3 -m pip install --user ansible
      shell: bash
    - run: ansible --version
      shell: bash
    - run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.DEPLOYMENT_SERVER_SSH_PRIVKEY }}" | tr -d '\r' > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        eval "$(ssh-agent -s)"
        ssh-add ~/.ssh/id_rsa
        ssh-keyscan -t rsa ${{ secrets.DEPLOYMENT_SERVER }} >> ~/.ssh/known_hosts
      shell: bash
    - run: echo .ssh/id_rsa
      shell: bash